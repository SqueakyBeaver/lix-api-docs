<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Nix: flake</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/svg+xml" href="logo.drawio.svg"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Nix
   &#160;<span id="projectnumber">2.93.0-dev</span>
   </div>
   <div id="projectbrief">Lix: A modern, delicious implementation of the Nix package manager; unstable internal interfaces</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_lix_2nix_2flake.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">flake</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>R""(</p>
<h1><a class="anchor" id="autotoc_md55"></a>
Description</h1>
<p><code>nix flake</code> provides subcommands for creating, modifying and querying <em>Nix flakes</em>. Flakes are the unit for packaging Nix code in a reproducible and discoverable way. They can have dependencies on other flakes, making it possible to have multi-repository Nix projects.</p>
<p>A flake is a filesystem tree (typically fetched from a Git repository or a tarball) that contains a file named <code>flake.nix</code> in the root directory. <code>flake.nix</code> specifies some metadata about the flake such as dependencies (called <em>inputs</em>), as well as its <em>outputs</em> (the Nix values such as packages or NixOS modules provided by the flake).</p>
<h1><a class="anchor" id="autotoc_md56"></a>
Flake references</h1>
<p>Flake references (<em>flakerefs</em>) are a way to specify the location of a flake. These have two different forms:</p>
<h2><a class="anchor" id="autotoc_md57"></a>
Attribute set representation</h2>
<p>Example:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  type = &quot;github&quot;;</div>
<div class="line">  owner = &quot;NixOS&quot;;</div>
<div class="line">  repo = &quot;nixpkgs&quot;;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The only required attribute is <code>type</code>. The supported types are listed below.</p>
<h2><a class="anchor" id="autotoc_md58"></a>
URL-like syntax</h2>
<p>Example:</p>
<div class="fragment"><div class="line">github:NixOS/nixpkgs</div>
</div><!-- fragment --><p>These are used on the command line as a more convenient alternative to the attribute set representation. For instance, in the command</p>
<div class="fragment"><div class="line"># nix build github:NixOS/nixpkgs#hello</div>
</div><!-- fragment --><p><code>github:NixOS/nixpkgs</code> is a flake reference (while <code>hello</code> is an output attribute). They are also allowed in the <code>inputs</code> attribute of a flake, e.g.</p>
<div class="fragment"><div class="line">inputs.nixpkgs.url = &quot;github:NixOS/nixpkgs&quot;;</div>
</div><!-- fragment --><p>is equivalent to</p>
<div class="fragment"><div class="line">inputs.nixpkgs = {</div>
<div class="line">  type = &quot;github&quot;;</div>
<div class="line">  owner = &quot;NixOS&quot;;</div>
<div class="line">  repo = &quot;nixpkgs&quot;;</div>
<div class="line">};</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md59"></a>
Examples</h3>
<p>Here are some examples of flake references in their URL-like representation:</p>
<ul>
<li><code>nixpkgs</code>: The <code>nixpkgs</code> entry in the flake registry.</li>
<li><code>nixpkgs/a3a3dda3bacf61e8a39258a0ed9c924eeca8e293</code>: The <code>nixpkgs</code> entry in the flake registry, with its Git revision overridden to a specific value.</li>
<li><code>github:NixOS/nixpkgs</code>: The <code>master</code> branch of the <code>NixOS/nixpkgs</code> repository on GitHub.</li>
<li><code>github:NixOS/nixpkgs/nixos-20.09</code>: The <code>nixos-20.09</code> branch of the <code>nixpkgs</code> repository.</li>
<li><code>github:NixOS/nixpkgs/a3a3dda3bacf61e8a39258a0ed9c924eeca8e293</code>: A specific revision of the <code>nixpkgs</code> repository.</li>
<li><code>github:edolstra/nix-warez?dir=blender</code>: A flake in a subdirectory of a GitHub repository.</li>
<li><code>git+https://github.com/NixOS/patchelf</code>: A Git repository.</li>
<li><code>git+https://github.com/NixOS/patchelf?ref=master</code>: A specific branch of a Git repository.</li>
<li><code>git+https://github.com/NixOS/patchelf?ref=master&amp;rev=f34751b88bd07d7f44f5cd3200fb4122bf916c7e</code>: A specific branch <em>and</em> revision of a Git repository.</li>
<li><code><a href="https://github.com/NixOS/patchelf/archive/master.tar.gz">https://github.com/NixOS/patchelf/archive/master.tar.gz</a></code>: A tarball flake.</li>
</ul>
<h2><a class="anchor" id="autotoc_md60"></a>
Path-like syntax</h2>
<p>Flakes corresponding to a local path can also be referred to by a direct path reference, either <code>/absolute/path/to/the/flake</code> or <code>./relative/path/to/the/flake</code> (note that the leading <code>./</code> is mandatory for relative paths to avoid any ambiguity).</p>
<p>The semantic of such a path is as follows:</p>
<ul>
<li>If the directory is part of a Git repository, then the input will be treated as a <code>git+file:</code> URL, otherwise it will be treated as a <code>path:</code> url;</li>
<li>If the directory doesn't contain a <code>flake.nix</code> file, then Lix will search for such a file upwards in the file system hierarchy until it finds any of:<ol type="1">
<li>The Git repository root, or</li>
<li>The filesystem root (/), or</li>
<li>A folder on a different mount point.</li>
</ol>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md61"></a>
Examples</h3>
<ul>
<li><code>.</code>: The flake to which the current directory belongs to.</li>
<li><code>/home/alice/src/patchelf</code>: A flake in some other directory.</li>
</ul>
<h2><a class="anchor" id="autotoc_md62"></a>
Flake reference attributes</h2>
<p>The following generic flake reference attributes are supported:</p>
<ul>
<li><code>dir</code>: The subdirectory of the flake in which <code>flake.nix</code> is located. This parameter enables having multiple flakes in a repository or tarball. The default is the root directory of the flake.</li>
<li><code>narHash</code>: The hash of the NAR serialisation (in SRI format) of the contents of the flake. This is useful for flake types such as tarballs that lack a unique content identifier such as a Git commit hash.</li>
</ul>
<p>In addition, the following attributes are common to several flake reference types:</p>
<ul>
<li><code>rev</code>: A Git or Mercurial commit hash.</li>
<li><p class="startli"><code>ref</code>: A Git or Mercurial branch or tag name.</p>
<p class="startli">On Git, this is the branch on which the <code>rev</code> commit appears.</p>
</li>
</ul>
<p><a class="el" href="classFinally.html">Finally</a>, some attribute are typically not specified by the user, but can occur in <em>locked</em> flake references and are available to Nix code:</p>
<ul>
<li><code>revCount</code>: The number of ancestors of the commit <code>rev</code>.</li>
<li><code>lastModified</code>: The timestamp (in seconds since the Unix epoch) of the last modification of this version of the flake. For Git/Mercurial flakes, this is the commit time of commit <em>rev</em>, while for tarball flakes, it's the most recent timestamp of any file inside the tarball.</li>
</ul>
<h2><a class="anchor" id="autotoc_md63"></a>
Types</h2>
<p>Currently the <code>type</code> attribute can be one of the following:</p>
<ul>
<li><p class="startli"><code>path</code>: arbitrary local directories, or local Git trees. The required attribute <code>path</code> specifies the path of the flake. The URL form is</p>
<div class="fragment"><div class="line">[path:]&lt;path&gt;(\?&lt;params)?</div>
</div><!-- fragment --><p class="startli">where <em>path</em> is an absolute path.</p>
<p class="startli"><em>path</em> must be a directory in the file system containing a file named <code>flake.nix</code>.</p>
<p class="startli"><em>path</em> generally must be an absolute path. However, on the command line, it can be a relative path (e.g. <code>.</code> or <code>./foo</code>) which is interpreted as relative to the current directory. In this case, it must start with <code>.</code> to avoid ambiguity with registry lookups (e.g. <code>nixpkgs</code> is a registry lookup; <code>./nixpkgs</code> is a relative path).</p>
</li>
<li><p class="startli"><code>git</code>: Git repositories. The location of the repository is specified by the attribute <code>url</code>.</p>
<p class="startli">They have the URL form</p>
<div class="fragment"><div class="line">git(+http|+https|+ssh|+git|+file|):(//&lt;server&gt;)?&lt;path&gt;(\?&lt;params&gt;)?</div>
</div><!-- fragment --><p class="startli">The <code>ref</code> attribute defaults to resolving the <code>HEAD</code> reference.</p>
<p class="startli">The <code>rev</code> attribute must denote a commit that exists in the branch or tag specified by the <code>ref</code> attribute, since Lix doesn't do a full clone of the remote repository by default (and the Git protocol doesn't allow fetching a <code>rev</code> without a known <code>ref</code>). The default is the commit currently pointed to by <code>ref</code>.</p>
<p class="startli">When <code>git+file</code> is used without specifying <code>ref</code> or <code>rev</code>, files are fetched directly from the local <code>path</code> as long as they have been added to the Git repository. If there are uncommitted changes, the reference is treated as dirty and a warning is printed.</p>
<p class="startli">For example, the following are valid Git flake references:</p><ul>
<li><code>git+https://example.org/my/repo</code></li>
<li><code>git+https://example.org/my/repo?dir=flake1</code></li>
<li><code>git+ssh://git@github.com/NixOS/nix?ref=v1.2.3</code></li>
<li><code>git://github.com/edolstra/dwarffs?ref=unstable&amp;rev=e486d8d40e626a20e06d792db8cc5ac5aba9a5b4</code></li>
<li><code>git+file:///home/my-user/some-repo/some-repo</code></li>
</ul>
</li>
<li><code>mercurial</code>: Mercurial repositories. The URL form is similar to the <code>git</code> type, except that the URL schema must be one of <code>hg+http</code>, <code>hg+https</code>, <code>hg+ssh</code> or <code>hg+file</code>.</li>
<li><p class="startli"><code>tarball</code>: Tarballs. The location of the tarball is specified by the attribute <code>url</code>.</p>
<p class="startli">In URL form, the schema must be <code>tarball+http://</code>, <code>tarball+https://</code> or <code>tarball+file://</code>. If the extension corresponds to a known archive format (<code>.zip</code>, <code>.tar</code>, <code>.tgz</code>, <code>.tar.gz</code>, <code>.tar.xz</code>, <code>.tar.bz2</code> or <code>.tar.zst</code>), then the <code>tarball+</code> can be dropped.</p>
<p class="startli">These URLs can indicate an immutable version's URL via the HTTP Link header in a response or any redirect leading up to it; see the Lockable HTTP Tarball Protocol in the manual for details. This protocol is used by several services on the Internet to rewrite an unlocked URL to a locked one. For example, it is supported by the archive URLs on Forgejo: <code><a href="https://git.lix.systems/lix-project/lix/archive/main.tar.gz">https://git.lix.systems/lix-project/lix/archive/main.tar.gz</a></code> works as a stable flake input.</p>
</li>
<li><p class="startli"><code>file</code>: Plain files or directory tarballs, either over http(s) or from the local disk.</p>
<p class="startli">In URL form, the schema must be <code>file+http://</code>, <code>file+https://</code> or <code>file+file://</code>. If the extension doesn’t correspond to a known archive format (as defined by the <code>tarball</code> fetcher), then the <code>file+</code> prefix can be dropped.</p>
</li>
<li><p class="startli"><code>github</code>: A more efficient way to fetch repositories from GitHub. The following attributes are required:</p><ul>
<li><code>owner</code>: The owner of the repository.</li>
<li><code>repo</code>: The name of the repository.</li>
</ul>
<p class="startli">These are downloaded as tarball archives, rather than through Git. This is often much faster and uses less disk space since it doesn't require fetching the entire history of the repository. On the other hand, it doesn't allow incremental fetching (but full downloads are often faster than incremental fetches!).</p>
<p class="startli">The URL syntax for <code>github</code> flakes is:</p>
<div class="fragment"><div class="line">github:&lt;owner&gt;/&lt;repo&gt;(/&lt;rev-or-ref&gt;)?(\?&lt;params&gt;)?</div>
</div><!-- fragment --><p class="startli"><code>&lt;rev-or-ref&gt;</code> specifies the name of a branch or tag (<code>ref</code>), or a commit hash (<code>rev</code>). Note that unlike Git, GitHub allows fetching by commit hash without specifying a branch or tag.</p>
<p class="startli">You can also specify <code>host</code> as a parameter, to point to a custom GitHub Enterprise server.</p>
<p class="startli">Some examples:</p><ul>
<li><code>github:edolstra/dwarffs</code></li>
<li><code>github:edolstra/dwarffs/unstable</code></li>
<li><code>github:edolstra/dwarffs/d3f2baba8f425779026c6ec04021b2e927f61e31</code></li>
<li><code>github:internal/project?host=company-github.example.org</code></li>
<li><code>github://github.com/lix-project/lix?ref=release-2.92</code></li>
</ul>
</li>
<li><p class="startli"><code>gitlab</code>: Similar to <code>github</code>, is a more efficient way to fetch GitLab repositories. The following attributes are required:</p><ul>
<li><code>owner</code>: The owner of the repository.</li>
<li><code>repo</code>: The name of the repository.</li>
</ul>
<p class="startli">Like <code>github</code>, these are downloaded as tarball archives.</p>
<p class="startli">The URL syntax for <code>gitlab</code> flakes is:</p>
<p class="startli"><code>gitlab:&lt;owner&gt;/&lt;repo&gt;(/&lt;rev-or-ref&gt;)?(\?&lt;params&gt;)?</code></p>
<p class="startli"><code>&lt;rev-or-ref&gt;</code> works the same as <code>github</code>. Either a branch or tag name (<code>ref</code>), or a commit hash (<code>rev</code>) can be specified.</p>
<p class="startli">Since GitLab allows for self-hosting, you can specify <code>host</code> as a parameter, to point to any instances other than <code>gitlab.com</code>.</p>
<p class="startli">Some examples:</p><ul>
<li><code>gitlab:veloren/veloren</code></li>
<li><code>gitlab:veloren/veloren/master</code></li>
<li><code>gitlab:veloren/veloren/80a4d7f13492d916e47d6195be23acae8001985a</code></li>
<li><code>gitlab:openldap/openldap?host=git.openldap.org</code></li>
</ul>
<p class="startli">When accessing a project in a (nested) subgroup, make sure to URL-encode any slashes, i.e. replace <code>/</code> with <code>%2F</code>:</p><ul>
<li><code>gitlab:veloren%2Fdev/rfcs</code></li>
</ul>
</li>
<li><p class="startli"><code>sourcehut</code>: Similar to <code>github</code>, is a more efficient way to fetch SourceHut repositories. The following attributes are required:</p><ul>
<li><code>owner</code>: The owner of the repository (including leading <code>~</code>).</li>
<li><code>repo</code>: The name of the repository.</li>
</ul>
<p class="startli">Like <code>github</code>, these are downloaded as tarball archives.</p>
<p class="startli">The URL syntax for <code>sourcehut</code> flakes is:</p>
<p class="startli"><code>sourcehut:&lt;owner&gt;/&lt;repo&gt;(/&lt;rev-or-ref&gt;)?(\?&lt;params&gt;)?</code></p>
<p class="startli"><code>&lt;rev-or-ref&gt;</code> works the same as <code>github</code>. Either a branch or tag name (<code>ref</code>), or a commit hash (<code>rev</code>) can be specified.</p>
<p class="startli">Since SourceHut allows for self-hosting, you can specify <code>host</code> as a parameter, to point to any instances other than <code>git.sr.ht</code>.</p>
<p class="startli">Currently, <code>ref</code> name resolution only works for Git repositories. You can refer to Mercurial repositories by simply changing <code>host</code> to <code>hg.sr.ht</code> (or any other Mercurial instance). With the caveat that you must explicitly specify a commit hash (<code>rev</code>).</p>
<p class="startli">Some examples:</p><ul>
<li><code>sourcehut:~misterio/nix-colors</code></li>
<li><code>sourcehut:~misterio/nix-colors/main</code></li>
<li><code>sourcehut:~misterio/nix-colors?host=git.example.org</code></li>
<li><code>sourcehut:~misterio/nix-colors/182b4b8709b8ffe4e9774a4c5d6877bf6bb9a21c</code></li>
<li><code>sourcehut:~misterio/nix-colors/21c1a380a6915d890d408e9f22203436a35bb2de?host=hg.sr.ht</code></li>
</ul>
</li>
<li><p class="startli"><code>indirect</code>: Indirections through the flake registry. These have the form</p>
<div class="fragment"><div class="line">[flake:]&lt;flake-id&gt;(/&lt;rev-or-ref&gt;(/rev)?)?</div>
</div><!-- fragment --><p class="startli">These perform a lookup of <code>&lt;flake-id&gt;</code> in the flake registry. For example, <code>nixpkgs</code> and <code>nixpkgs/release-20.09</code> are indirect flake references. The specified <code>rev</code> and/or <code>ref</code> are merged with the entry in the registry; see nix registry for details.</p>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md64"></a>
Flake format</h1>
<p>As an example, here is a simple <code>flake.nix</code> that depends on the Nixpkgs flake and provides a single package (i.e. an <a href="./nix.md#installables">installable</a> derivation):</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  description = &quot;A flake for building Hello World&quot;;</div>
<div class="line"> </div>
<div class="line">  inputs.nixpkgs.url = &quot;github:NixOS/nixpkgs/nixos-20.03&quot;;</div>
<div class="line"> </div>
<div class="line">  outputs = { self, nixpkgs }: {</div>
<div class="line"> </div>
<div class="line">    packages.x86_64-linux.default =</div>
<div class="line">      # Notice the reference to nixpkgs here.</div>
<div class="line">      with import nixpkgs { system = &quot;x86_64-linux&quot;; };</div>
<div class="line">      stdenv.mkDerivation {</div>
<div class="line">        name = &quot;hello&quot;;</div>
<div class="line">        src = self;</div>
<div class="line">        buildPhase = &quot;gcc -o hello ./hello.c&quot;;</div>
<div class="line">        installPhase = &quot;mkdir -p $out/bin; install -t $out/bin hello&quot;;</div>
<div class="line">      };</div>
<div class="line"> </div>
<div class="line">  };</div>
<div class="line">}</div>
</div><!-- fragment --><p>The following attributes are supported in <code>flake.nix</code>:</p>
<ul>
<li><code>description</code>: A short, one-line description of the flake.</li>
<li><code>inputs</code>: An attrset specifying the dependencies of the flake (described below).</li>
<li><p class="startli"><code>outputs</code>: A function that, given an attribute set containing the outputs of each of the input flakes keyed by their identifier, yields the Nix values provided by this flake. Thus, in the example above, <code>inputs.nixpkgs</code> contains the result of the call to the <code>outputs</code> function of the <code>nixpkgs</code> flake.</p>
<p class="startli">In addition to the outputs of each input, each input in <code>inputs</code> also contains some metadata about the inputs. These are:</p><ul>
<li><code>outPath</code>: The path in the Nix store of the flake's source tree. This way, the attribute set can be passed to <code>import</code> as if it was a path, as in the example above (<code>import nixpkgs</code>).</li>
<li><code>rev</code>: The commit hash of the flake's repository, if applicable.</li>
<li><code>revCount</code>: The number of ancestors of the revision <code>rev</code>. This is not available for <code>github</code> repositories, since they're fetched as tarballs rather than as Git repositories.</li>
<li><code>lastModifiedDate</code>: The commit time of the revision <code>rev</code>, in the format <code>YmdHMS</code> (e.g. <code>20181231100934</code>). Unlike <code>revCount</code>, this is available for both Git and GitHub repositories, so it's useful for generating (hopefully) monotonically increasing version strings.</li>
<li><code>lastModified</code>: The commit time of the revision <code>rev</code> as an integer denoting the number of seconds since 1970.</li>
<li><code>narHash</code>: The SHA-256 (in SRI format) of the NAR serialization of the flake's source tree.</li>
</ul>
<p class="startli">The value returned by the <code>outputs</code> function must be an attribute set. The attributes can have arbitrary values; however, various <code>nix</code> subcommands require specific attributes to have a specific value (e.g. <code>packages.x86_64-linux</code> must be an attribute set of derivations built for the <code>x86_64-linux</code> platform).</p>
</li>
<li><p class="startli"><code>nixConfig</code>: a set of <code>nix.conf</code> options to be set when evaluating any part of a flake. This attribute is only considered if the flake is at top-level (i.e. if it is passed directly to <code>nix build</code>, <code>nix run</code>, etc, rather than as an input of another flake). In the interests of security, only a small set of set of options is allowed to be set without confirmation so long as <a href="@docroot@/command-ref/conf-file.md#conf-accept-flake-config"><code>accept-flake-config</code></a> is not enabled in the global configuration:</p><ul>
<li><a href="@docroot@/command-ref/conf-file.md#conf-bash-prompt"><code>bash-prompt</code></a></li>
<li><a href="@docroot@/command-ref/conf-file.md#conf-bash-prompt-prefix"><code>bash-prompt-prefix</code></a></li>
<li><a href="@docroot@/command-ref/conf-file.md#conf-bash-prompt-suffix"><code>bash-prompt-suffix</code></a></li>
<li><a href="@docroot@/command-ref/conf-file.md#conf-flake-registry"><code>flake-registry</code></a></li>
<li><a href="@docroot@/command-ref/conf-file.md#conf-commit-lockfile-summary"><code>commit-lockfile-summary</code></a></li>
</ul>
<p class="startli">For the avoidance of doubt, setting <code>accept-flake-config</code> in <code>nix.conf</code> or passing <code>--accept-flake-config</code> <em>allows root access to your machine</em> if you are running as a trusted user and don't read <code>nixConfig</code> in every flake you build.</p>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md65"></a>
Flake inputs</h2>
<p>The attribute <code>inputs</code> specifies the dependencies of a flake, as an attrset mapping input names to flake references. For example, the following specifies a dependency on the <code>nixpkgs</code> and <code>import-cargo</code> repositories:</p>
<div class="fragment"><div class="line"># A GitHub repository.</div>
<div class="line">inputs.import-cargo = {</div>
<div class="line">  type = &quot;github&quot;;</div>
<div class="line">  owner = &quot;edolstra&quot;;</div>
<div class="line">  repo = &quot;import-cargo&quot;;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"># An indirection through the flake registry.</div>
<div class="line">inputs.nixpkgs = {</div>
<div class="line">  type = &quot;indirect&quot;;</div>
<div class="line">  id = &quot;nixpkgs&quot;;</div>
<div class="line">};</div>
</div><!-- fragment --><p>Alternatively, you can use the URL-like syntax:</p>
<div class="fragment"><div class="line">inputs.import-cargo.url = &quot;github:edolstra/import-cargo&quot;;</div>
<div class="line">inputs.nixpkgs.url = &quot;nixpkgs&quot;;</div>
</div><!-- fragment --><p>Each input is fetched, evaluated and passed to the <code>outputs</code> function as a set of attributes with the same name as the corresponding input. The special input named <code>self</code> refers to the outputs and source tree of <em>this</em> flake. Thus, a typical <code>outputs</code> function looks like this:</p>
<div class="fragment"><div class="line">outputs = { self, nixpkgs, import-cargo }: {</div>
<div class="line">  ... outputs ...</div>
<div class="line">};</div>
</div><!-- fragment --><p>It is also possible to omit an input entirely and <em>only</em> list it as expected function argument to <code>outputs</code>. Thus,</p>
<div class="fragment"><div class="line">outputs = { self, nixpkgs }: ...;</div>
</div><!-- fragment --><p>without an <code>inputs.nixpkgs</code> attribute is equivalent to</p>
<div class="fragment"><div class="line">inputs.nixpkgs = {</div>
<div class="line">  type = &quot;indirect&quot;;</div>
<div class="line">  id = &quot;nixpkgs&quot;;</div>
<div class="line">};</div>
</div><!-- fragment --><p>Repositories that don't contain a <code>flake.nix</code> can also be used as inputs, by setting the input's <code>flake</code> attribute to <code>false</code>:</p>
<div class="fragment"><div class="line">inputs.grcov = {</div>
<div class="line">  type = &quot;github&quot;;</div>
<div class="line">  owner = &quot;mozilla&quot;;</div>
<div class="line">  repo = &quot;grcov&quot;;</div>
<div class="line">  flake = false;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">outputs = { self, nixpkgs, grcov }: {</div>
<div class="line">  packages.x86_64-linux.grcov = stdenv.mkDerivation {</div>
<div class="line">    src = grcov;</div>
<div class="line">    ...</div>
<div class="line">  };</div>
<div class="line">};</div>
</div><!-- fragment --><p>Transitive inputs can be overridden from a <code>flake.nix</code> file. For example, the following overrides the <code>nixpkgs</code> input of the <code>nixops</code> input:</p>
<div class="fragment"><div class="line">inputs.nixops.inputs.nixpkgs = {</div>
<div class="line">  type = &quot;github&quot;;</div>
<div class="line">  owner = &quot;my-org&quot;;</div>
<div class="line">  repo = &quot;nixpkgs&quot;;</div>
<div class="line">};</div>
</div><!-- fragment --><p>It is also possible to "inherit" an input from another input. This is useful to minimize flake dependencies. For example, the following sets the <code>nixpkgs</code> input of the top-level flake to be equal to the <code>nixpkgs</code> input of the <code>dwarffs</code> input of the top-level flake:</p>
<div class="fragment"><div class="line">inputs.nixpkgs.follows = &quot;dwarffs/nixpkgs&quot;;</div>
</div><!-- fragment --><p>The value of the <code>follows</code> attribute is a <code>/</code>-separated sequence of input names denoting the path of inputs to be followed from the root flake.</p>
<p>Overrides and <code>follows</code> can be combined, e.g.</p>
<div class="fragment"><div class="line">inputs.nixops.inputs.nixpkgs.follows = &quot;dwarffs/nixpkgs&quot;;</div>
</div><!-- fragment --><p>sets the <code>nixpkgs</code> input of <code>nixops</code> to be the same as the <code>nixpkgs</code> input of <code>dwarffs</code>. It is worth noting, however, that it is generally not useful to eliminate transitive <code>nixpkgs</code> flake inputs in this way. Most flakes provide their functionality through Nixpkgs overlays or NixOS modules, which are composed into the top-level flake's <code>nixpkgs</code> input; so their own <code>nixpkgs</code> input is usually irrelevant.</p>
<h1><a class="anchor" id="autotoc_md66"></a>
Lock files</h1>
<p>Inputs specified in <code>flake.nix</code> are typically "unlocked" in the sense that they don't specify an exact revision. To ensure reproducibility, Nix will automatically generate and use a <em>lock file</em> called <code>flake.lock</code> in the flake's directory. The lock file contains a graph structure isomorphic to the graph of dependencies of the root flake. Each node in the graph (except the root node) maps the (usually) unlocked input specifications in <code>flake.nix</code> to locked input specifications. Each node also contains some metadata, such as the dependencies (outgoing edges) of the node.</p>
<p>For example, if <code>flake.nix</code> has the inputs in the example above, then the resulting lock file might be:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;version&quot;: 7,</div>
<div class="line">  &quot;root&quot;: &quot;n1&quot;,</div>
<div class="line">  &quot;nodes&quot;: {</div>
<div class="line">    &quot;n1&quot;: {</div>
<div class="line">      &quot;inputs&quot;: {</div>
<div class="line">        &quot;nixpkgs&quot;: &quot;n2&quot;,</div>
<div class="line">        &quot;import-cargo&quot;: &quot;n3&quot;,</div>
<div class="line">        &quot;grcov&quot;: &quot;n4&quot;</div>
<div class="line">      }</div>
<div class="line">    },</div>
<div class="line">    &quot;n2&quot;: {</div>
<div class="line">      &quot;inputs&quot;: {},</div>
<div class="line">      &quot;locked&quot;: {</div>
<div class="line">        &quot;owner&quot;: &quot;edolstra&quot;,</div>
<div class="line">        &quot;repo&quot;: &quot;nixpkgs&quot;,</div>
<div class="line">        &quot;rev&quot;: &quot;7f8d4b088e2df7fdb6b513bc2d6941f1d422a013&quot;,</div>
<div class="line">        &quot;type&quot;: &quot;github&quot;,</div>
<div class="line">        &quot;lastModified&quot;: 1580555482,</div>
<div class="line">        &quot;narHash&quot;: &quot;sha256-OnpEWzNxF/AU4KlqBXM2s5PWvfI5/BS6xQrPvkF5tO8=&quot;</div>
<div class="line">      },</div>
<div class="line">      &quot;original&quot;: {</div>
<div class="line">        &quot;id&quot;: &quot;nixpkgs&quot;,</div>
<div class="line">        &quot;type&quot;: &quot;indirect&quot;</div>
<div class="line">      }</div>
<div class="line">    },</div>
<div class="line">    &quot;n3&quot;: {</div>
<div class="line">      &quot;inputs&quot;: {},</div>
<div class="line">      &quot;locked&quot;: {</div>
<div class="line">        &quot;owner&quot;: &quot;edolstra&quot;,</div>
<div class="line">        &quot;repo&quot;: &quot;import-cargo&quot;,</div>
<div class="line">        &quot;rev&quot;: &quot;8abf7b3a8cbe1c8a885391f826357a74d382a422&quot;,</div>
<div class="line">        &quot;type&quot;: &quot;github&quot;,</div>
<div class="line">        &quot;lastModified&quot;: 1567183309,</div>
<div class="line">        &quot;narHash&quot;: &quot;sha256-wIXWOpX9rRjK5NDsL6WzuuBJl2R0kUCnlpZUrASykSc=&quot;</div>
<div class="line">      },</div>
<div class="line">      &quot;original&quot;: {</div>
<div class="line">        &quot;owner&quot;: &quot;edolstra&quot;,</div>
<div class="line">        &quot;repo&quot;: &quot;import-cargo&quot;,</div>
<div class="line">        &quot;type&quot;: &quot;github&quot;</div>
<div class="line">      }</div>
<div class="line">    },</div>
<div class="line">    &quot;n4&quot;: {</div>
<div class="line">      &quot;inputs&quot;: {},</div>
<div class="line">      &quot;locked&quot;: {</div>
<div class="line">        &quot;owner&quot;: &quot;mozilla&quot;,</div>
<div class="line">        &quot;repo&quot;: &quot;grcov&quot;,</div>
<div class="line">        &quot;rev&quot;: &quot;989a84bb29e95e392589c4e73c29189fd69a1d4e&quot;,</div>
<div class="line">        &quot;type&quot;: &quot;github&quot;,</div>
<div class="line">        &quot;lastModified&quot;: 1580729070,</div>
<div class="line">        &quot;narHash&quot;: &quot;sha256-235uMxYlHxJ5y92EXZWAYEsEb6mm+b069GAd+BOIOxI=&quot;</div>
<div class="line">      },</div>
<div class="line">      &quot;original&quot;: {</div>
<div class="line">        &quot;owner&quot;: &quot;mozilla&quot;,</div>
<div class="line">        &quot;repo&quot;: &quot;grcov&quot;,</div>
<div class="line">        &quot;type&quot;: &quot;github&quot;</div>
<div class="line">      },</div>
<div class="line">      &quot;flake&quot;: false</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p>This graph has 4 nodes: the root flake, and its 3 dependencies. The nodes have arbitrary labels (e.g. <code>n1</code>). The label of the root node of the graph is specified by the <code>root</code> attribute. Nodes contain the following fields:</p>
<ul>
<li><code>inputs</code>: The dependencies of this node, as a mapping from input names (e.g. <code>nixpkgs</code>) to node labels (e.g. <code>n2</code>).</li>
<li><code>original</code>: The original input specification from <code>flake.lock</code>, as a set of <code>builtins.fetchTree</code> arguments.</li>
<li><p class="startli"><code>locked</code>: The locked input specification, as a set of <code>builtins.fetchTree</code> arguments. Thus, in the example above, when we build this flake, the input <code>nixpkgs</code> is mapped to revision <code>7f8d4b088e2df7fdb6b513bc2d6941f1d422a013</code> of the <code>edolstra/nixpkgs</code> repository on GitHub.</p>
<p class="startli">It also includes the attribute <code>narHash</code>, specifying the expected contents of the tree in the Nix store (as computed by <code>nix hash-path</code>), and may include input-type-specific attributes such as the <code>lastModified</code> or <code>revCount</code>. The main reason for these attributes is to allow flake inputs to be substituted from a binary cache: <code>narHash</code> allows the store path to be computed, while the other attributes are necessary because they provide information not stored in the store path.</p>
</li>
<li><code>flake</code>: A Boolean denoting whether this is a flake or non-flake dependency. Corresponds to the <code>flake</code> attribute in the <code>inputs</code> attribute in <code>flake.nix</code>.</li>
</ul>
<p>The <code>original</code> and <code>locked</code> attributes are omitted for the root node. This is because we cannot record the commit hash or content hash of the root flake, since modifying <code>flake.lock</code> will invalidate these.</p>
<p>The graph representation of lock files allows circular dependencies between flakes. For example, here are two flakes that reference each other:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  inputs.b = ... location of flake B ...;</div>
<div class="line">  # Tell the &#39;b&#39; flake not to fetch &#39;a&#39; again, to ensure its &#39;a&#39; is</div>
<div class="line">  # *this* &#39;a&#39;.</div>
<div class="line">  inputs.b.inputs.a.follows = &quot;&quot;;</div>
<div class="line">  outputs = { self, b }: {</div>
<div class="line">    foo = 123 + b.bar;</div>
<div class="line">    xyzzy = 1000;</div>
<div class="line">  };</div>
<div class="line">}</div>
</div><!-- fragment --><p>and</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  inputs.a = ... location of flake A ...;</div>
<div class="line">  inputs.a.inputs.b.follows = &quot;&quot;;</div>
<div class="line">  outputs = { self, a }: {</div>
<div class="line">    bar = 456 + a.xyzzy;</div>
<div class="line">  };</div>
<div class="line">}</div>
</div><!-- fragment --><p>Lock files transitively lock direct as well as indirect dependencies. That is, if a lock file exists and is up to date, Nix will not look at the lock files of dependencies. However, lock file generation itself <em>does</em> use the lock files of dependencies by default.</p>
<p>)"" </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
